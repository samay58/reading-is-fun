# v0.4 Improvements - Voice, Speed, and Cost Transparency

**Date**: October 31, 2025 2:45 AM
**Changes**: Voice upgrade + speed optimization + detailed cost/stats display

---

## Changes Made

### 1. Voice Changed: alloy → onyx ✅

**File**: `lib/tts.ts:23`

**Why**: onyx is masculine, clear, professional (better for long-form narration)

**Before**: `voice = 'alloy'` (neutral/feminine)
**After**: `voice = 'onyx'` (masculine, professional)

---

### 2. Speed Increased: 1.0x → 1.1x ✅

**File**: `lib/tts.ts:24`

**Why**: 10% faster playback makes long content more digestible

**Before**: `speed = 1.0` (normal)
**After**: `speed = 1.1` (10% faster)

**Impact**: 20-minute audio → 18 minutes (saves 2 minutes listening time)

---

### 3. Enhanced Cost Display ✅

**Files**: `lib/cost.ts`, `components/Preview.tsx`, `app/api/process/[id]/route.ts`

**New functions**:
- `calculateExactCost()` - Uses actual char count (not estimate)
- `estimateAudioDuration()` - Calculates minutes based on ~150 words/min at 1.1x speed

**Display improvements**:

**Before** (simple):
```
18 pages processed
0 tables summarized
Total cost: $0.43
```

**After** (detailed):
```
Generation Summary:
• Audio Duration: 22 minutes
• Processing Time: 42s
• Text Processed: 20.6K chars
• Tables Narrated: 10

Cost Breakdown:
• DeepSeek OCR: FREE
• Claude narrations (10 tables): $0.15
• OpenAI TTS (14 chunks): $1.68
• Total: $1.83
```

---

## New Stats Displayed

**Generation summary**:
- Audio duration (minutes and seconds)
- Processing time (actual seconds taken)
- Text processed (original → cleaned char count)
- Tables narrated (count with context)
- TTS chunks (for transparency)

**Cost breakdown**:
- DeepSeek OCR: $0.00 (always FREE)
- Claude narrations: # tables × $0.015
- OpenAI TTS: # chunks, chars/1000 × $0.030
- Total cost (sum of all)

---

## Audio Duration Calculation

**Formula**:
```
Words per minute = 150 (standard narration)
Adjusted for speed = 150 × 1.1 = 165 words/min
Chars per minute = 165 words × 5 chars/word = 825 chars/min
Duration (minutes) = total_chars / 825
```

**Example** (20,615 chars):
```
20,615 / 825 = 25 minutes of audio
```

---

## Cost Accuracy

**Now uses exact counts** (not estimates):
- Actual character count after cleaning
- Actual table count extracted
- Exact TTS chunk count

**Before**: Estimated based on page count
**After**: Calculated from actual text extracted

**Example** (18-page PDF):
- Before estimate: $0.60 (rough)
- After actual: $1.68 (based on 56K chars extracted)
- Difference: Cost depends on text density, not just pages

---

## Testing

**Expected when you upload PDF**:

**Console logs**:
```
DeepSeek OCR: 18 pages, 56115 chars
Extracting HTML tables...
Found 10 tables
Cost estimate: $1.83, Audio: ~22min
Generating audio (20615 chars)...
Text is 20615 chars, chunking into 6 pieces...
Generating audio chunk 1/6... 2/6... etc.
Complete! Cost: $1.83, TTS time: 42s
```

**UI displays**:
- Generation Summary (4 stats in grid)
- Cost Breakdown (3-line itemization + total)
- Text Preview (first 500 chars)

---

## Files Modified

1. `lib/tts.ts` - Voice: onyx, Speed: 1.1x
2. `lib/cost.ts` - Added calculateExactCost(), estimateAudioDuration()
3. `components/Preview.tsx` - Enhanced with stats grid + cost breakdown
4. `app/api/process/[id]/route.ts` - Returns stats object
5. `lib/types.ts` - Added stats to ProcessingResult interface
6. `app/page.tsx` - Passes stats to Preview component

---

*Build status: ✅ Passing - Ready to test with onyx voice at 1.1x speed*
